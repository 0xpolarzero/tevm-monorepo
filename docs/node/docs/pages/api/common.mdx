# Common Package

The `@tevm/common` package provides chain-specific configuration and utilities for Tevm clients. It wraps both Viem chain configurations and EthereumJS Common functionality to provide a unified interface for chain parameters, hardforks, and EIPs.

## Main Exports

### Common Type

The main type representing chain-specific configuration:

```typescript
type Common = {
  // Chain Identification
  id: number
  name: string
  nativeCurrency: ChainNativeCurrency

  // Chain Configuration
  rpcUrls: {
    default: ChainRpcUrls
    [key: string]: ChainRpcUrls
  }
  blockExplorers?: {
    default: ChainBlockExplorer
    [key: string]: ChainBlockExplorer
  }

  // Contract Information
  contracts?: {
    ensRegistry?: ChainContract
    ensUniversalResolver?: ChainContract
    multicall3?: ChainContract
  }

  // Chain Properties
  testnet?: boolean
  sourceId?: number

  // EthereumJS Common Instance
  ethjsCommon: EthjsCommon

  // Utilities
  copy(): Common
}
```

### Creating a Common Instance

The main factory function to create a Common instance:

```typescript
function createCommon(options: CommonOptions): Common
```

#### CommonOptions

```typescript
type CommonOptions = ViemChain & {
  // Hardfork configuration (default: 'cancun')
  hardfork?: Hardfork

  // EIPs to enable (default: [1559, 4895])
  eips?: ReadonlyArray<number>

  // Logging configuration (default: 'warn')
  loggingLevel?: LogOptions['level']

  // Custom crypto implementations
  customCrypto?: CustomCrypto
}
```

### Hardfork Support

The package supports various Ethereum hardforks:

```typescript
type Hardfork =
  | 'chainstart'
  | 'homestead'
  | 'dao'
  | 'tangerineWhistle'
  | 'spuriousDragon'
  | 'byzantium'
  | 'constantinople'
  | 'petersburg'
  | 'istanbul'
  | 'muirGlacier'
  | 'berlin'
  | 'london'
  | 'arrowGlacier'
  | 'grayGlacier'
  | 'mergeForkIdTransition'
  | 'paris'
  | 'shanghai'
  | 'cancun'
  | 'prague'
  | 'osaka'
```

### Preset Chains

The package includes preset configurations for many chains. Here are some common ones:

```typescript
import {
  mainnet,    // Ethereum Mainnet
  goerli,     // Goerli Testnet
  sepolia,    // Sepolia Testnet
  optimism,   // Optimism
  arbitrum,   // Arbitrum
  polygon,    // Polygon
  // ... many more
} from '@tevm/common'
```

## Usage Examples

### Basic Usage

```typescript
import { createCommon, mainnet } from '@tevm/common'
import { createMemoryClient } from 'tevm'

// Using a preset chain
const client = createMemoryClient({
  common: mainnet
})

// Creating a custom chain configuration
const customCommon = createCommon({
  ...mainnet,
  hardfork: 'london',
  eips: [1559, 4895],
  loggingLevel: 'debug'
})
```

### Custom Chain Configuration

```typescript
import { createCommon } from '@tevm/common'

const myChainCommon = createCommon({
  id: 1234,
  name: 'My Custom Chain',
  nativeCurrency: {
    name: 'My Token',
    symbol: 'MTK',
    decimals: 18
  },
  rpcUrls: {
    default: {
      http: ['https://my-chain-rpc.example.com']
    }
  },
  hardfork: 'london',
  eips: [1559]
})
```

### Using with EthereumJS

```typescript
import { VM } from '@ethereumjs/vm'
import { createCommon } from '@tevm/common'

const common = createCommon({
  // ... chain configuration
})

const vm = new VM({
  common: common.ethjsCommon
})
```

### State Management

The package also includes interfaces for EVM state management:

```typescript
interface EvmStateManagerInterface {
  getAccount(address: Address): Promise<Account | undefined>
  putAccount(address: Address, account?: Account): Promise<void>
  deleteAccount(address: Address): Promise<void>
  getContractCode(address: Address): Promise<Uint8Array>
  putContractCode(address: Address, value: Uint8Array): Promise<void>
  getContractStorage(address: Address, key: Uint8Array): Promise<Uint8Array>
  putContractStorage(address: Address, key: Uint8Array, value: Uint8Array): Promise<void>
  // ... additional state management methods
}
```

## Error Handling

The package uses the `@tevm/errors` package for error handling. Common errors include:

- `InvalidParamsError`: Thrown when invalid parameters are provided to `createCommon`
- Chain-specific validation errors from EthereumJS Common

## Custom Cryptography

The package supports custom cryptographic implementations through the `CustomCrypto` interface:

```typescript
interface CustomCrypto {
  keccak256?(msg: Uint8Array): Uint8Array
  ecrecover?(msgHash: Uint8Array, v: bigint, r: Uint8Array, s: Uint8Array, chainId?: bigint): Uint8Array
  ecsign?(msg: Uint8Array, pk: Uint8Array, chainId?: bigint): ECDSASignature
  ecdsaSign?(msg: Uint8Array, pk: Uint8Array): { signature: Uint8Array; recid: number }
  kzg?: Kzg
  // ... other crypto methods
}
```